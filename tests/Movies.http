### Movie88 API Testing - All Endpoints
### Base URL
@baseUrl = https://movie88aspnet-app.up.railway.app/api
# https://localhost:7238/api
# ho·∫∑c http://localhost:5203/api n·∫øu d√πng HTTP

### Variables
@movieId = 1
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1laWQiOiIyOCIsImVtYWlsIjoic3dpZnR5azE4QGdtYWlsLmNvbSIsInVuaXF1ZV9uYW1lIjoiYWtvYSIsInJvbGUiOiJDdXN0b21lciIsImp0aSI6Ijg5ZTkzZWU1LTk0MjQtNDQ1Zi1hYTk5LWIxYzQ4ZTY3ZjMwMyIsIm5iZiI6MTc2MjQyNDcwMiwiZXhwIjoxNzYyNDI4MzAyLCJpYXQiOjE3NjI0MjQ3MDIsImlzcyI6Ik1vdmllODhBUEkiLCJhdWQiOiJNb3ZpZTg4Q2xpZW50In0.616rlCJU-8BGktnBsa1wpUwkx35nD2ZuRyPTfa1oGA8

###############################################
# 0. AUTHENTICATION - Login & Register
###############################################
### Test 0.1: Login to get access token
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "swiftyk18@gmail.com",
  "password": "123123"
}

### Test 0.3: Extract token from login response (manual copy)
# After running Test 0.2, copy the "token" value from response
# and paste it into @accessToken variable above

###############################################
# 1. GET /api/movies - Get all movies with pagination
###############################################

### Test 1.1: Basic request (default page 1, pageSize 10)
GET {{baseUrl}}/movies
Accept: application/json

### Test 1.2: With pagination
GET {{baseUrl}}/movies?page=1&pageSize=5
Accept: application/json

### Test 1.3: Filter by genre
GET {{baseUrl}}/movies?genre=Action
Accept: application/json

### Test 1.4: Filter by year
GET {{baseUrl}}/movies?year=2023
Accept: application/json

### Test 1.5: Filter by rating
GET {{baseUrl}}/movies?rating=PG-13
Accept: application/json

### Test 1.6: Sort by release date descending (newest first)
GET {{baseUrl}}/movies?sort=releasedate_desc
Accept: application/json

### Test 1.7: Sort by title ascending (A-Z)
GET {{baseUrl}}/movies?sort=title_asc
Accept: application/json

### Test 1.8: Combined filters
GET {{baseUrl}}/movies?genre=Action&year=2023&rating=PG-13&sort=releasedate_desc&page=1&pageSize=10
Accept: application/json

###############################################
# 2. GET /api/movies/now-showing - Currently showing movies
###############################################

### Test 2.1: Get now showing movies
GET {{baseUrl}}/movies/now-showing
Accept: application/json

### Test 2.2: Now showing with pagination
GET {{baseUrl}}/movies/now-showing?page=1&pageSize=5
Accept: application/json

###############################################
# 3. GET /api/movies/coming-soon - Upcoming movies
###############################################

### Test 3.1: Get coming soon movies
GET {{baseUrl}}/movies/coming-soon
Accept: application/json

### Test 3.2: Coming soon with pagination
GET {{baseUrl}}/movies/coming-soon?page=1&pageSize=5
Accept: application/json

###############################################
# 4. GET /api/movies/search - Search movies
###############################################

### Test 4.1: Search by movie title
GET {{baseUrl}}/movies/search?query=Avengers
Accept: application/json

### Test 4.2: Search by director
GET {{baseUrl}}/movies/search?query=Christopher%20Nolan
Accept: application/json

### Test 4.3: Search by genre
GET {{baseUrl}}/movies/search?query=Action
Accept: application/json

### Test 4.4: Search with pagination
GET {{baseUrl}}/movies/search?query=Action&page=1&pageSize=5
Accept: application/json

### Test 4.5: Search with empty query (should return 400)
GET {{baseUrl}}/movies/search?query=
Accept: application/json

### Test 4.6: Search without query parameter (should return 400)
GET {{baseUrl}}/movies/search
Accept: application/json

###############################################
# 5. GET /api/movies/{id} - Get movie by ID
###############################################

### Test 5.1: Get movie by valid ID
GET {{baseUrl}}/movies/{{movieId}}
Accept: application/json

### Test 5.2: Get movie by ID = 2
GET {{baseUrl}}/movies/2
Accept: application/json

### Test 5.3: Get movie by ID = 5
GET {{baseUrl}}/movies/5
Accept: application/json

### Test 5.4: Get movie by invalid ID (should return 404)
GET {{baseUrl}}/movies/99999
Accept: application/json

###############################################
# 6. GET /api/promotions/active - Get active promotions
###############################################

### Test 6.1: Get all active promotions
GET {{baseUrl}}/promotions/active
Accept: application/json

###############################################
# 7. GET /api/customers/profile - Get customer profile (AUTH REQUIRED)
###############################################

### Test 7.1: Get customer profile with valid token
GET {{baseUrl}}/customers/profile
Accept: application/json
Authorization: Bearer {{accessToken}}

### Test 7.2: Get customer profile without token (should return 401)
GET {{baseUrl}}/customers/profile
Accept: application/json

### Test 7.3: Get customer profile with invalid token (should return 401)
GET {{baseUrl}}/customers/profile
Accept: application/json
Authorization: Bearer invalid_token_here

###############################################
# Expected Response Format
###############################################

### Customer Profile Response Format:
# {
#   "isSuccess": true,
#   "message": "Customer profile retrieved successfully",
#   "statusCode": 200,
#   "data": {
#     "customerid": 1,
#     "userid": 2,
#     "fullname": "John Doe",
#     "email": "john.doe@example.com",
#     "phone": "+84901234567",
#     "address": "123 Main St, Hanoi",
#     "dateofbirth": "1990-05-15",
#     "gender": "Male",
#     "createdat": "2024-01-15T10:30:00"
#   },
#   "errors": []
# }

### Promotions Response Format:
# {
#   "isSuccess": true,
#   "message": "Active promotions retrieved successfully",
#   "statusCode": 200,
#   "data": [
#     {
#       "promotionid": 1,
#       "name": "Summer Sale 2024",
#       "description": "Get 20% off on all tickets",
#       "startdate": "2024-06-01",
#       "enddate": "2024-08-31",
#       "discounttype": "percentage",
#       "discountvalue": 20.00
#     }
#   ],
#   "errors": []
# }

### Movies Response Format:
# {
#   "isSuccess": true,
#   "message": "Movies retrieved successfully",
#   "statusCode": 200,
#   "data": {
#     "items": [
#       {
#         "movieid": 1,
#         "title": "The Avengers",
#         "description": "Earth's mightiest heroes...",
#         "durationminutes": 143,
#         "director": "Joss Whedon",
#         "trailerurl": "https://...",
#         "releasedate": "2012-05-04",
#         "posterurl": "https://...",
#         "country": "USA",
#         "rating": "PG-13",
#         "genre": "Action, Sci-Fi, Adventure"
#       }
#     ],
#     "currentPage": 1,
#     "pageSize": 10,
#     "totalPages": 5,
#     "totalItems": 48,
#     "hasNextPage": true,
#     "hasPreviousPage": false
#   },
#   "errors": []
# }

###############################################
# Test Checklist
###############################################

### ‚úÖ Test Cases to Verify:
# 1. Pagination works correctly
# 2. Filters (genre, year, rating) work individually
# 3. Filters work in combination
# 4. Sorting works for all options
# 5. Now showing only returns movies with active showtimes
# 6. Coming soon only returns future movies
# 7. Search works for title, director, genre, description
# 8. Search is case-insensitive
# 9. Invalid movie ID returns 404
# 10. Empty search query returns 400

###############################################
# 8. GET /api/bookings/my-bookings - Get current user's bookings
###############################################

### Test 8.1: Get all bookings for current user (default pagination)
GET {{baseUrl}}/bookings/my-bookings
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.2: Get bookings with pagination
GET {{baseUrl}}/bookings/my-bookings?page=1&pageSize=5
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.3: Filter by status - Completed
GET {{baseUrl}}/bookings/my-bookings?status=completed
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.4: Filter by status - Confirmed
GET {{baseUrl}}/bookings/my-bookings?status=confirmed
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.5: Filter by status - Pending
GET {{baseUrl}}/bookings/my-bookings?status=pending
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.6: Filter by status - Cancelled
GET {{baseUrl}}/bookings/my-bookings?status=cancelled
Authorization: Bearer {{accessToken}}
Accept: application/json

### Test 8.7: Unauthorized request (no token)
GET {{baseUrl}}/bookings/my-bookings
Accept: application/json

###############################################
# Expected Response Format for My Bookings
###############################################

### My Bookings Response Format:
# {
#   "isSuccess": true,
#   "message": "Bookings retrieved successfully",
#   "statusCode": 200,
#   "data": {
#     "items": [
#       {
#         "bookingid": 13,
#         "customerid": 22,
#         "showtimeid": 623,
#         "movie": {
#           "movieid": 51,
#           "title": "Oppenheimer",
#           "posterurl": "https://image.tmdb.org/t/p/original/..."
#         },
#         "cinema": {
#           "cinemaid": 2,
#           "name": "Movie 88 - S∆∞ V·∫°n H·∫°nh",
#           "address": "10 S∆∞ V·∫°n H·∫°nh, P. 12, Qu·∫≠n 10",
#           "city": "TP.HCM"
#         },
#         "showtime": {
#           "starttime": "2025-11-06T21:30:00",
#           "format": "2D",
#           "languagetype": "Ph·ª• ƒë·ªÅ",
#           "auditoriumname": "Ph√≤ng 1"
#         },
#         "seats": ["D 7", "D 8"],
#         "combos": [
#           {
#             "name": "Combo 1",
#             "quantity": 2,
#             "price": 70000.00
#           }
#         ],
#         "voucherCode": null,
#         "bookingcode": "M88-20251106-QSJHA",
#         "totalamount": 220000.00,
#         "status": "Confirmed",
#         "bookingtime": "2025-11-06T09:39:55"
#       }
#     ],
#     "currentPage": 1,
#     "pageSize": 10,
#     "totalPages": 1,
#     "totalItems": 1,
#     "hasNextPage": false,
#     "hasPreviousPage": false
#   },
#   "errors": []
# }

###############################################
# Notes
###############################################

### üìù Before running tests:
# 1. Make sure API is running: dotnet run --project Movie88.WebApi
# 2. Update @baseUrl if using different port
# 3. Check Swagger UI: https://localhost:7106/swagger
# 4. Verify database has movies data
# 5. Install REST Client extension in VS Code
# 6. Login first (Test 0.1) to get valid accessToken

### üìù Database should have:
# - At least 10 movies for pagination testing
# - Movies with different genres (Action, Comedy, Drama, etc.)
# - Movies with different years (2020-2024)
# - Movies with different ratings (G, PG, PG-13, R)
# - Movies with showtimes (for now-showing test)
# - Movies without showtimes or future release dates (for coming-soon test)
# - Bookings for customerid=5 (userId=11) with different statuses
