### Movie88 API Testing - Admin User Management
### Base URL
# @baseUrl = https://movie88aspnet-app.up.railway.app/api
@baseUrl = https://localhost:7238/api
# @baseUrl = http://localhost:5203/api

### Variables
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1laWQiOiIzOCIsImVtYWlsIjoiYmllYmVyQGV4YW1wbGUuY29tIiwidW5pcXVlX25hbWUiOiJKdXN0aW4gQmllYmVyIiwicm9sZSI6IkFkbWluIiwianRpIjoiOTlmMzRmOGYtMzEwZC00ZTZhLWFlOTEtMjZkYmRjMzJhMTVkIiwibmJmIjoxNzYyMzQ3Nzg4LCJleHAiOjE3NjIzNTEzODgsImlhdCI6MTc2MjM0Nzc4OCwiaXNzIjoiTW92aWU4OEFQSSIsImF1ZCI6Ik1vdmllODhDbGllbnQifQ.8HcbxOGHwYNKLIjOB3QG1ZIIwo6BOgGZtE3mDerTYrk
@userId = 38

###############################################
# 0. AUTHENTICATION - Login as Admin
###############################################

### Test 0.1: Login as Admin to get admin token
# @name adminLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "hoangviet@example.com",
  "password": "123456"
}

### Test 0.2: Copy token from response above and paste to @adminToken variable

###############################################
# 1. GET /api/admin/users - Get all users with filters
###############################################

### Test 1.1: Get all users (default pagination)
GET {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.2: Get users with pagination
GET {{baseUrl}}/admin/users?page=1&pageSize=5
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.3: Filter by role - Customer
GET {{baseUrl}}/admin/users?role=Customer
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.4: Filter by role - Staff
GET {{baseUrl}}/admin/users?role=staff
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.5: Filter by role - Admin
GET {{baseUrl}}/admin/users?role=Admin
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.6: Filter by status - Active users
GET {{baseUrl}}/admin/users?status=active
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.7: Filter by status - Inactive users (banned)
GET {{baseUrl}}/admin/users?status=inactive
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.8: Search by email
GET {{baseUrl}}/admin/users?search=hoangviet@example.com
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.9: Search by fullname
GET {{baseUrl}}/admin/users?search=BM4
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.10: Combined filters
GET {{baseUrl}}/admin/users?role=Admin&status=inactive&search=BM4&page=1&pageSize=10
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 1.11: Unauthorized request (no token) - Should return 401
GET {{baseUrl}}/admin/users
Accept: application/json

### Test 1.12: Non-admin token - Should return 403
GET {{baseUrl}}/admin/users
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.customer_token_here
Accept: application/json

###############################################
# 2. POST /api/admin/users - Create Staff or Admin
###############################################

### Test 2.1: Create Staff user with all fields
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "staff01@movie88.com",
  "password": "Movie88@1",
  "fullname": "Nguyen Van Staff",
  "role": "Staff",
  "phone": "0901234567"
}

### Test 2.2: Create Admin user with minimal fields
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "admin02@movie88.com",
  "password": "Admin@123456",
  "fullname": "Tran Thi Admin",
  "role": "Admin"
}


### Test 2.4: Try to create Customer (should fail - 400)
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "customer@movie88.com",
  "password": "Customer@123",
  "fullname": "Customer User",
  "role": "Customer"
}

### Test 2.5: Create with duplicate email (should fail - 400)
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "staff01@movie88.com",
  "password": "Staff@123456",
  "fullname": "Duplicate Email",
  "role": "Staff"
}

### Test 2.6: Create with weak password (should fail - 400)
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "weakpass@movie88.com",
  "password": "123",
  "fullname": "Weak Password User",
  "role": "Staff"
}

### Test 2.7: Create with invalid role (should fail - 400)
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "invalid@movie88.com",
  "password": "Valid@123456",
  "fullname": "Invalid Role",
  "role": "SuperAdmin"
}

### Test 2.8: Create without required fields (should fail - 400)
POST {{baseUrl}}/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "missing@movie88.com"
}

###############################################
# 3. PUT /api/admin/users/{id}/role - Update user role
###############################################

### Test 3.1: Promote Customer to Staff
PUT {{baseUrl}}/admin/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Staff"
}

### Test 3.2: Promote Staff to Admin
PUT {{baseUrl}}/admin/users/12/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Admin"
}

### Test 3.3: Demote Admin to Staff
PUT {{baseUrl}}/admin/users/13/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Staff"
}

### Test 3.4: Demote Staff to Customer
PUT {{baseUrl}}/admin/users/14/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Customer"
}

### Test 3.5: Try to demote yourself (should fail - 400)
# First get your own userId from login response, then try:
PUT {{baseUrl}}/admin/users/1/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Staff"
}

### Test 3.6: Update to invalid role (should fail - 400)
PUT {{baseUrl}}/admin/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "SuperUser"
}

### Test 3.7: Update non-existent user (should fail - 404)
PUT {{baseUrl}}/admin/users/99999/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newRole": "Staff"
}

###############################################
# 4. PUT /api/admin/users/{id}/ban - Ban/Unban user
###############################################

### Test 4.1: Ban user (set isActive = false)
PUT {{baseUrl}}/admin/users/{{userId}}/ban
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": false
}

### Test 4.2: Unban user (set isActive = true)
PUT {{baseUrl}}/admin/users/{{userId}}/ban
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": true
}

### Test 4.3: Ban another user
PUT {{baseUrl}}/admin/users/17/ban
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": false
}

### Test 4.4: Try to ban yourself (should fail - 400)
# Use your own userId from login response
PUT {{baseUrl}}/admin/users/29/ban
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": false
}

### Test 4.5: Ban non-existent user (should fail - 404)
PUT {{baseUrl}}/admin/users/99999/ban
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": false
}


###############################################
# Expected Response Formats
###############################################

### GET Users Response Format:
# {
#   "isSuccess": true,
#   "message": "Users retrieved successfully",
#   "statusCode": 200,
#   "data": {
#     "items": [
#       {
#         "userId": 11,
#         "email": "user@example.com",
#         "fullname": "Nguyen Van A",
#         "role": "Customer",
#         "isActive": true,
#         "isVerified": true,
#         "registeredAt": "2025-09-15T10:30:00",
#         "totalBookings": 12,
#         "totalSpent": 2400000,
#         "lastLogin": null
#       }
#     ],
#     "currentPage": 1,
#     "pageSize": 50,
#     "totalPages": 170,
#     "totalItems": 8500,
#     "hasNextPage": true,
#     "hasPreviousPage": false
#   },
#   "errors": []
# }

### POST User Response Format:
# {
#   "isSuccess": true,
#   "message": "User created successfully",
#   "statusCode": 201,
#   "data": {
#     "userId": 789,
#     "email": "staff01@movie88.com",
#     "fullname": "Nguyen Van Staff",
#     "role": "Staff",
#     "isActive": true,
#     "isVerified": false,
#     "phone": "0901234567",
#     "createdAt": "2025-11-04T15:30:00",
#     "updatedAt": null
#   },
#   "errors": []
# }

### PUT Role Response Format:
# {
#   "isSuccess": true,
#   "message": "User role updated successfully",
#   "statusCode": 200,
#   "data": {
#     "userId": 123,
#     "email": "user@example.com",
#     "fullname": "Nguyen Van A",
#     "role": "Staff",
#     "isActive": true,
#     "isVerified": true,
#     "phone": "0901234567",
#     "createdAt": "2025-09-15T10:30:00",
#     "updatedAt": "2025-11-04T15:30:00"
#   },
#   "errors": []
# }

### PUT Ban Response Format:
# {
#   "isSuccess": true,
#   "message": "User banned successfully",
#   "statusCode": 200,
#   "data": {
#     "userId": 456,
#     "email": "spammer@example.com",
#     "fullname": "Bad User",
#     "role": "Customer",
#     "isActive": false,
#     "isVerified": true,
#     "phone": null,
#     "createdAt": "2025-10-01T08:00:00",
#     "updatedAt": "2025-11-04T15:45:00"
#   },
#   "errors": []
# }

###############################################
# Test Checklist
###############################################

### âœ… Test Cases to Verify:
# 
# GET /api/admin/users:
# 1. âœ… Pagination works correctly
# 2. âœ… Filter by role (customer, staff, admin)
# 3. âœ… Filter by status (active, inactive)
# 4. âœ… Search by email works
# 5. âœ… Search by fullname works
# 6. âœ… Combined filters work
# 7. âœ… Aggregated data (totalBookings, totalSpent) displays correctly
# 8. âŒ Non-admin access returns 403
# 9. âŒ No token returns 401
#
# POST /api/admin/users:
# 1. âœ… Create Staff with all fields
# 2. âœ… Create Admin with minimal fields
# 3. âŒ Cannot create Customer role
# 4. âŒ Duplicate email returns 400
# 5. âŒ Weak password returns 400
# 6. âŒ Invalid role returns 400
# 7. âœ… Created user has isActive=true, isVerified=false
# 8. âœ… Password is hashed
#
# PUT /api/admin/users/{id}/role:
# 1. âœ… Promote Customer â†’ Staff
# 2. âœ… Promote Staff â†’ Admin
# 3. âœ… Demote Admin â†’ Staff
# 4. âŒ Cannot demote yourself
# 5. âŒ Invalid role returns 400
# 6. âŒ Non-existent user returns 404
#
# PUT /api/admin/users/{id}/ban:
# 1. âœ… Ban user (isActive=false)
# 2. âœ… Unban user (isActive=true)
# 3. âŒ Cannot ban yourself
# 4. âŒ Non-existent user returns 404
# 5. âœ… Banned user cannot login
# 6. âœ… Banned user cannot make bookings

###############################################
# Notes
###############################################

### ðŸ“ Before running tests:
# 1. Make sure API is running: dotnet run --project Movie88.WebApi
# 2. Login as Admin first (Test 0.1) to get admin token
# 3. Copy token from response and paste to @adminToken variable
# 4. Update @baseUrl if using different environment
# 5. Check Swagger UI: https://localhost:7238/swagger
# 6. Install REST Client extension in VS Code

### ðŸ“ Test Data Requirements:
# - At least 1 Admin user in database
# - At least 10 users for pagination testing
# - Users with different roles (Customer, Staff, Admin)
# - Users with bookings (for aggregated data testing)
# - Both active and inactive users

### ðŸ“ Security Notes:
# - Only users with "Admin" role can access these endpoints
# - Admin cannot demote or ban themselves
# - Customer role cannot be created via this endpoint (use register instead)
# - Password must be strong (8+ chars, uppercase, number, special char)
# - All timestamps are stored as "timestamp without time zone" in PostgreSQL

###############################################
# 5. REPORTS & ANALYTICS - Dashboard Stats
###############################################

### Test 5.1: Get dashboard overview
GET {{baseUrl}}/admin/dashboard/stats
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 5.2: Dashboard without auth (should fail - 401)
GET {{baseUrl}}/admin/dashboard/stats
Accept: application/json

###############################################
# 6. REPORTS - Daily Revenue
###############################################

### Test 6.1: Get revenue for today
GET {{baseUrl}}/admin/reports/revenue/daily?date=2025-11-05
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 6.2: Get revenue for specific date
GET {{baseUrl}}/admin/reports/revenue/daily?date=2025-11-04
Authorization: Bearer {{adminToken}}
Accept: application/json


### Test 6.5: Missing date parameter (should fail - 400)
GET {{baseUrl}}/admin/reports/revenue/daily
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 6.6: Invalid date format (should fail - 400)
GET {{baseUrl}}/admin/reports/revenue/daily?date=invalid-date
Authorization: Bearer {{adminToken}}
Accept: application/json

###############################################
# 7. REPORTS - Monthly Revenue
###############################################

### Test 7.1: Get revenue for current month
GET {{baseUrl}}/admin/reports/revenue/monthly?month=11&year=2025
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.2: Get revenue for previous month
GET {{baseUrl}}/admin/reports/revenue/monthly?month=10&year=2025
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.3: Get revenue for specific month/year
GET {{baseUrl}}/admin/reports/revenue/monthly?month=9&year=2025
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.4: Get revenue for January
GET {{baseUrl}}/admin/reports/revenue/monthly?month=1&year=2025
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.5: Get revenue for December
GET {{baseUrl}}/admin/reports/revenue/monthly?month=12&year=2024
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.6: Invalid month (should fail - 400)
GET {{baseUrl}}/admin/reports/revenue/monthly?month=13&year=2025
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.7: Invalid year (should fail - 400)
GET {{baseUrl}}/admin/reports/revenue/monthly?month=11&year=1999
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 7.8: Missing parameters (should fail - 400)
GET {{baseUrl}}/admin/reports/revenue/monthly
Authorization: Bearer {{adminToken}}
Accept: application/json

###############################################
# 8. REPORTS - Booking Statistics
###############################################

### Test 8.1: Get statistics for last 7 days
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-10-29&endDate=2025-11-05
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.2: Get statistics for last 30 days
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-10-06&endDate=2025-11-05
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.3: Get statistics for specific week
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-11-01&endDate=2025-11-07
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.4: Get statistics for single day
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-11-05&endDate=2025-11-05
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.5: Get statistics for entire year
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-01-01&endDate=2025-12-31
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.6: Invalid date range (end before start - should fail - 400)
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-11-05&endDate=2025-11-01
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 8.7: Missing parameters (should fail - 400)
GET {{baseUrl}}/admin/reports/bookings/statistics?startDate=2025-11-01
Authorization: Bearer {{adminToken}}
Accept: application/json

###############################################
# 9. REPORTS - Popular Movies
###############################################

### Test 9.1: Get top 10 popular movies (last month)
GET {{baseUrl}}/admin/reports/popular-movies?period=month&limit=10
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.2: Get top 5 popular movies (last week)
GET {{baseUrl}}/admin/reports/popular-movies?period=week&limit=5
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.3: Get top 20 popular movies (last year)
GET {{baseUrl}}/admin/reports/popular-movies?period=year&limit=20
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.4: Get top 3 popular movies (default period)
GET {{baseUrl}}/admin/reports/popular-movies?limit=3
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.5: Get popular movies with default limit
GET {{baseUrl}}/admin/reports/popular-movies?period=month
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.6: Get all popular movies (high limit)
GET {{baseUrl}}/admin/reports/popular-movies?period=year&limit=50
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.7: Invalid period value
GET {{baseUrl}}/admin/reports/popular-movies?period=invalid&limit=10
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 9.8: Limit exceeds max (should cap at 50)
GET {{baseUrl}}/admin/reports/popular-movies?period=month&limit=100
Authorization: Bearer {{adminToken}}
Accept: application/json

###############################################
# 10. REPORTS - Customer Analytics
###############################################

### Test 10.1: Get customer analytics for last month
GET {{baseUrl}}/admin/reports/customers/analytics?period=month&topCustomersLimit=10
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.2: Get customer analytics for last week
GET {{baseUrl}}/admin/reports/customers/analytics?period=week&topCustomersLimit=5
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.3: Get customer analytics for last year
GET {{baseUrl}}/admin/reports/customers/analytics?period=year&topCustomersLimit=20
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.4: Get all-time customer analytics
GET {{baseUrl}}/admin/reports/customers/analytics?period=all&topCustomersLimit=10
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.5: Get top 3 customers only
GET {{baseUrl}}/admin/reports/customers/analytics?period=month&topCustomersLimit=3
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.6: Get with default parameters
GET {{baseUrl}}/admin/reports/customers/analytics
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.7: Check demographics breakdown (age groups)
# Should return age distribution: 18-24, 25-34, 35-44, 45+
GET {{baseUrl}}/admin/reports/customers/analytics?period=all
Authorization: Bearer {{adminToken}}
Accept: application/json

### Test 10.8: Check demographics breakdown (gender)
# Should return gender distribution: male, female
GET {{baseUrl}}/admin/reports/customers/analytics?period=year
Authorization: Bearer {{adminToken}}
Accept: application/json

###############################################
# Expected Response Formats - Reports
###############################################

### Dashboard Stats Response:
# {
#   "success": true,
#   "data": {
#     "todayRevenue": 45000000,
#     "todayBookings": 450,
#     "activeMovies": 25,
#     "activeCustomers": 3200,
#     "popularMovies": [
#       {
#         "movieId": 1,
#         "title": "Avengers: Endgame",
#         "posterUrl": "https://...",
#         "totalBookings": 1250,
#         "revenue": 185000000
#       }
#     ],
#     "upcomingShowtimes": [
#       {
#         "showtimeId": 123,
#         "movieTitle": "Avatar 2",
#         "cinemaName": "CGV Vincom",
#         "auditoriumName": "Screen 1",
#         "startTime": "2025-11-05T19:00:00",
#         "price": 100000,
#         "format": "3D",
#         "totalSeats": 200,
#         "availableSeats": 45
#       }
#     ]
#   }
# }

### Daily Revenue Response:
# {
#   "success": true,
#   "data": {
#     "period": "2025-11-04",
#     "totalRevenue": 45000000,
#     "totalBookings": 450,
#     "averageTicketPrice": 100000,
#     "breakdown": {
#       "ticketSales": 42000000,
#       "concessions": 3000000
#     },
#     "byMovie": [
#       {
#         "movieId": 1,
#         "movieTitle": "Avengers",
#         "revenue": 18500000,
#         "bookings": 185
#       }
#     ],
#     "byCinema": [
#       {
#         "cinemaId": 1,
#         "cinemaName": "CGV Vincom",
#         "revenue": 25000000,
#         "bookings": 250
#       }
#     ],
#     "byHour": [
#       {
#         "hour": "10:00-11:00",
#         "revenue": 2000000,
#         "bookings": 20
#       }
#     ]
#   }
# }

### Booking Statistics Response:
# {
#   "success": true,
#   "data": {
#     "totalBookings": 12500,
#     "completedBookings": 11800,
#     "canceledBookings": 700,
#     "checkedInBookings": 11200,
#     "cancellationRate": 5.6,
#     "checkInRate": 94.9,
#     "averageBookingValue": 180000,
#     "peakHours": ["19:00-20:00", "20:00-21:00"],
#     "peakDays": ["Saturday", "Sunday"],
#     "conversionRate": 94.4
#   }
# }

### Popular Movies Response:
# {
#   "success": true,
#   "data": [
#     {
#       "rank": 1,
#       "movieId": 1,
#       "title": "Avengers: Endgame",
#       "totalBookings": 1250,
#       "revenue": 185000000,
#       "averageOccupancy": 92.5,
#       "rating": 4.8,
#       "trend": "up"
#     }
#   ]
# }

### Customer Analytics Response:
# {
#   "success": true,
#   "data": {
#     "totalCustomers": 8500,
#     "newCustomers": 250,
#     "activeCustomers": 3200,
#     "retentionRate": 78.0,
#     "churnRate": 12.0,
#     "averageLifetimeValue": 2400000,
#     "topCustomers": [
#       {
#         "customerId": 123,
#         "fullname": "Nguyen Van A",
#         "email": "customer@example.com",
#         "totalBookings": 45,
#         "totalSpent": 8500000,
#         "memberSince": "2024-01-15T00:00:00"
#       }
#     ],
#     "demographics": {
#       "age": {
#         "18-24": 35.5,
#         "25-34": 40.2,
#         "35-44": 20.1,
#         "45+": 4.2
#       },
#       "gender": {
#         "male": 55.0,
#         "female": 45.0
#       }
#     }
#   }
# }

###############################################
# Test Checklist - Reports & Analytics
###############################################

### âœ… Dashboard Stats Tests:
# 1. âœ… Returns today's revenue correctly
# 2. âœ… Returns today's booking count
# 3. âœ… Returns active movies count
# 4. âœ… Returns active customers count
# 5. âœ… Returns top 5 popular movies
# 6. âœ… Returns upcoming showtimes (next 24h)
# 7. âœ… Shows available seats calculation
# 8. âŒ Unauthorized access returns 401
#
### âœ… Daily Revenue Tests:
# 1. âœ… Returns correct revenue for specific date
# 2. âœ… Breakdown shows ticket sales vs concessions
# 3. âœ… Revenue grouped by movie
# 4. âœ… Revenue grouped by cinema
# 5. âœ… Revenue grouped by hour (only for daily)
# 6. âœ… Returns zero for dates with no data
# 7. âŒ Invalid date returns 400
# 8. âŒ Missing date parameter returns 400
#
### âœ… Monthly Revenue Tests:
# 1. âœ… Returns correct revenue for month/year
# 2. âœ… Breakdown shows ticket sales vs concessions
# 3. âœ… Revenue grouped by movie
# 4. âœ… Revenue grouped by cinema
# 5. âœ… No byHour field (monthly report)
# 6. âŒ Invalid month (>12 or <1) returns 400
# 7. âŒ Invalid year returns 400
#
### âœ… Booking Statistics Tests:
# 1. âœ… Total bookings count correct
# 2. âœ… Completed bookings (Status = "Completed")
# 3. âœ… Canceled bookings (Status = "Cancelled")
# 4. âœ… Checked-in bookings (Checkedintime != null)
# 5. âœ… Cancellation rate calculated correctly
# 6. âœ… Check-in rate uses Checkedintime field
# 7. âœ… Average booking value from Totalamount
# 8. âœ… Peak hours from Showtime.Starttime
# 9. âœ… Peak days from Bookingtime
# 10. âœ… Conversion rate calculated
#
### âœ… Popular Movies Tests:
# 1. âœ… Movies ranked by revenue
# 2. âœ… Total bookings count correct
# 3. âœ… Occupancy rate calculated correctly
# 4. âœ… Average rating from Reviews table
# 5. âœ… Trend comparison (up/down/stable)
# 6. âœ… Period filter works (week/month/year)
# 7. âœ… Limit parameter works
# 8. âœ… Returns empty array if no data
#
### âœ… Customer Analytics Tests:
# 1. âœ… Total customers count
# 2. âœ… New customers (User.Createdat in period)
# 3. âœ… Active customers (with bookings in period)
# 4. âœ… Retention rate calculated
# 5. âœ… Churn rate calculated
# 6. âœ… Average lifetime value from Payments
# 7. âœ… Top customers by totalSpent
# 8. âœ… Age demographics from Dateofbirth
# 9. âœ… Gender demographics from Gender field
# 10. âœ… Period filter works (week/month/year/all)

###############################################
# Performance Notes
###############################################

### ðŸ“ Query Performance:
# - Dashboard stats: Multiple aggregations, may take 1-2 seconds
# - Daily revenue: JOIN 5+ tables, optimize with indexes
# - Monthly revenue: Larger date range, may take 2-3 seconds
# - Booking statistics: Calculates percentages, fast query
# - Popular movies: Complex JOIN with trend calculation
# - Customer analytics: Demographics grouping, may take 2-3 seconds
#
### ðŸ“ Optimization Tips:
# - Add indexes on: Paymenttime, Bookingtime, Status fields
# - Cache dashboard stats (refresh every 5 minutes)
# - Use pagination for large result sets
# - Consider materialized views for monthly reports
# - Run reports during off-peak hours for best performance
