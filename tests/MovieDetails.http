@baseUrl = https://localhost:7238/api

###############################################
# Section 0: Authentication (Login)
###############################################

### Login to get JWT token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "ngoctrungtsn111@gmail.com",
  "password": "123456"
}

# Copy the accessToken from the response and paste it here:
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1laWQiOiIxMSIsImVtYWlsIjoibmdvY3RydW5ndHNuMTExQGdtYWlsLmNvbSIsInVuaXF1ZV9uYW1lIjoiWnVuWnVuIiwicm9sZSI6IkN1c3RvbWVyIiwianRpIjoiZDdjNzNiNzItYzc2OS00MGRmLTk0ZjYtZGFkODczZTM4YWQyIiwibmJmIjoxNzYyMTg1NDEyLCJleHAiOjE3NjIxODkwMTIsImlhdCI6MTc2MjE4NTQxMiwiaXNzIjoiTW92aWU4OEFQSSIsImF1ZCI6Ik1vdmllODhDbGllbnQifQ.xk2Kf1Xn8OAVvQFfC1y-59JLwiRiLWBHyYrQO5Z7kJU


###############################################
# Section 1: GET /api/movies/{id} - Movie Details
###############################################

### 1.1 Get movie details by ID (existing movie)
GET {{baseUrl}}/movies/2
Content-Type: application/json

### 1.2 Get movie details - non-existent movie (should return 404)
GET {{baseUrl}}/movies/999
Content-Type: application/json

### 1.3 Verify computed fields (averageRating, totalReviews, totalShowtimes)
GET {{baseUrl}}/movies/2
Content-Type: application/json


###############################################
# Section 2: GET /api/movies/{id}/showtimes
###############################################

### 2.1 Get showtimes for a movie (no filters - default today onwards)
GET {{baseUrl}}/movies/1/showtimes
Content-Type: application/json

### 2.2 Get showtimes with specific date filter
GET {{baseUrl}}/movies/1/showtimes?date=2025-01-15
Content-Type: application/json

### 2.3 Get showtimes with cinema filter
GET {{baseUrl}}/movies/1/showtimes?cinemaid=1
Content-Type: application/json

### 2.4 Get showtimes with both date and cinema filters
GET {{baseUrl}}/movies/1/showtimes?date=2025-11-05&cinemaid=1
Content-Type: application/json

### 2.5 Get showtimes for movie with no upcoming showtimes (should return empty array)
GET {{baseUrl}}/movies/999/showtimes
Content-Type: application/json

### 2.6 Verify grouping structure (by date then by cinema)
GET {{baseUrl}}/movies/2/showtimes
Content-Type: application/json

### 2.7 Verify availableSeats calculation
GET {{baseUrl}}/movies/2/showtimes?date=2025-11-05
Content-Type: application/json


###############################################
# Section 3: GET /api/reviews/movie/{movieId}
###############################################

### 3.1 Get reviews for a movie (default pagination and sorting)
GET {{baseUrl}}/reviews/movie/1
Content-Type: application/json

### 3.2 Get reviews with pagination (page 1, pageSize 5)
GET {{baseUrl}}/reviews/movie/1?page=1&pageSize=5
Content-Type: application/json

### 3.3 Get reviews with pagination (page 2, pageSize 5)
GET {{baseUrl}}/reviews/movie/1?page=2&pageSize=5
Content-Type: application/json

### 3.4 Get reviews sorted by latest (default)
GET {{baseUrl}}/reviews/movie/1?sort=latest
Content-Type: application/json

### 3.5 Get reviews sorted by oldest
GET {{baseUrl}}/reviews/movie/1?sort=oldest
Content-Type: application/json

### 3.6 Get reviews sorted by highest rating
GET {{baseUrl}}/reviews/movie/1?sort=highest
Content-Type: application/json

### 3.7 Get reviews sorted by lowest rating
GET {{baseUrl}}/reviews/movie/1?sort=lowest
Content-Type: application/json

### 3.8 Get reviews for movie with no reviews (should return empty array)
GET {{baseUrl}}/reviews/movie/999
Content-Type: application/json

### 3.9 Verify averageRating in response metadata
GET {{baseUrl}}/reviews/movie/2
Content-Type: application/json

### 3.10 Test large pageSize (max 100)
GET {{baseUrl}}/reviews/movie/1?pageSize=100
Content-Type: application/json


###############################################
# Section 4: POST /api/reviews - Create Review
###############################################

### 4.1 Create a review - successful (with authentication)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 1,
  "rating": 5,
  "comment": "Amazing movie! The storyline was captivating and the acting was superb."
}

### 4.2 Create a review without authentication (should return 401)
POST {{baseUrl}}/reviews
Content-Type: application/json

{
  "movieid": 5,
  "rating": 5,
  "comment": "This should fail without token"
}

### 4.3 Create a review with invalid movie ID (should return 404)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 999,
  "rating": 5,
  "comment": "This movie doesn't exist"
}

### 4.4 Create a review with rating too low (should return 400)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 5,
  "rating": 0,
  "comment": "Invalid rating - too low"
}

### 4.5 Create a review with rating too high (should return 400)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 5,
  "rating": 6,
  "comment": "Invalid rating - too high"
}

### 4.6 Create a review with comment too long (should return 400)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 5,
  "rating": 5,
  "comment": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
}

### 4.7 Create a review without comment (optional field - should succeed)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 2,
  "rating": 4
}

### 4.8 Create a duplicate review (should return 409 Conflict)
# First, create a review for movie 1
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 1,
  "rating": 5,
  "comment": "First review for this movie"
}

### 4.9 Try to create another review for the same movie (should return 409)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 1,
  "rating": 3,
  "comment": "Trying to review the same movie again - should fail"
}

### 4.10 Create a minimal valid review (rating only, no comment)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 3,
  "rating": 3
}


###############################################
# Section 5: Integration Tests
###############################################

### 5.1 Full workflow: Get movie details → Get showtimes → Get reviews → Create review
# Step 1: Get movie details
GET {{baseUrl}}/movies/1
Content-Type: application/json

### Step 2: Get showtimes for the movie
GET {{baseUrl}}/movies/1/showtimes?date=2025-11-05
Content-Type: application/json

### Step 3: Get existing reviews
GET {{baseUrl}}/reviews/movie/1?sort=latest
Content-Type: application/json

### Step 4: Create a new review
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "movieid": 1,
  "rating": 5,
  "comment": "Excellent movie experience! Worth watching."
}

### Step 5: Verify the review was added (should see new review)
GET {{baseUrl}}/reviews/movie/1?sort=latest
Content-Type: application/json

### Step 6: Verify averageRating updated in movie details
GET {{baseUrl}}/movies/1
Content-Type: application/json
